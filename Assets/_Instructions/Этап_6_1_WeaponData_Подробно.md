# Урок 6.1: WeaponData — ScriptableObject с базовыми данными оружия

---

## 0. Теория и темы урока

В этом уроке мы делаем для оружия то же самое, что уже делали для игрока в уроке 5.1 (`PlayerData`):

- `PlayerData` хранит **базовые числа** игрока (макс. здоровье, скорость и т.п.).
- `PlayerStats` и `PlayerController` **используют** эти данные.

Теперь:

- **WeaponData** будет хранить базовые числа **оружия**:
  - урон;
  - скорость атаки;
  - дальность;
  - тип (ближний/дальний/магический);
  - дополнительные настройки (название, иконка, эффекты).
- Позже `WeaponBase`, `MeleeWeapon`, `RangedWeapon`, `WeaponManager` будут эти данные **читать**, а не «зашивать» числа прямо в код.

**Ключевые идеи:**

- **Разделение данных и логики** (как с `PlayerData`/`PlayerStats`).
- **Переиспользование** одного `WeaponData` в разных местах (игрок, инвентарь, лут).
- Подготовка к **наследованию и полиморфизму** на Этапе 6: логика у разных оружий разная, но данные описаны единообразно.

---

## 1. Цели урока

- **Техническая цель**: создать ScriptableObject `WeaponData` с полями урона, скорости атаки, дальности и т.п., и несколько ассетов оружия (меч, лук, посох).
- **Обучающая цель**: закрепить подход «данные отдельно от логики» и подготовить фундамент для наследования оружия.

После выполнения урока у тебя будут ассеты, например:

- `Weapon_Sword_Default`
- `Weapon_Bow_Default`
- `Weapon_Staff_Default`

которые будут использоваться в следующих уроках Этапа 6 и позже — в инвентаре и системе лута.

---

## 2. Подготовка папок

Перед началом убедись, что структура проекта соответствует общему плану (см. корневой `План разработки игры`):

- для скриптов:
  - `Assets/Scripts/Weapons/`
- для ScriptableObject:
  - `Assets/ScriptableObjects/Weapons/`

Если каких‑то папок нет — создай их:

1. В окне `Project`:
   - ПКМ по `Assets/Scripts` → `Create` → `Folder` → `Weapons`
2. Аналогично для ScriptableObject:
   - ПКМ по `Assets/ScriptableObjects` → `Create` → `Folder` → `Weapons`

---

## 3. Создание скрипта WeaponData

### 3.1. Шаги в Unity

1. В окне `Project` перейди в папку `Assets/Scripts/Weapons/`.
2. ПКМ → `Create` → `C# Script`.
3. Назови скрипт **`WeaponData`** (точно так же, как имя класса).
4. Дважды кликни по скрипту, чтобы открыть его в редакторе.

### 3.2. Что нужно сделать в коде

По умолчанию Unity создаст класс, наследующийся от `MonoBehaviour`. Нам нужно:

1. Изменить наследование с `MonoBehaviour` на `ScriptableObject`.
2. Добавить атрибут `[CreateAssetMenu]`, чтобы можно было создавать `WeaponData` через меню `Create`.
3. Добавить публичные поля с понятными атрибутами (`[Header]`, `[Tooltip]`, `[Min]`).

Ниже пример итогового кода. Используй его как ориентир, но набирай код **самостоятельно**, понимая каждую строку.

```csharp
using UnityEngine;

/// <summary>
/// Данные для оружия (урон, скорость, дальность и т.п.).
/// Используется разными системами: игрок, инвентарь, лут.
/// </summary>
[CreateAssetMenu(
    fileName = "WeaponData",
    menuName = "Game Data/Weapon Data",
    order = 0)]
public class WeaponData : ScriptableObject
{
    public enum WeaponType
    {
        Melee,   // Ближний бой (мечи, топоры)
        Ranged,  // Дальний бой (луки, арбалеты)
        Magic    // Магическое оружие (посохи и т.п.)
    }

    [Header("Общее")]
    [Tooltip("Читаемое название оружия (для UI).")]
    public string weaponName = "New Weapon";

    [Tooltip("Тип оружия (ближнее, дальнее, магическое).")]
    public WeaponType weaponType = WeaponType.Melee;

    [Tooltip("Иконка оружия для инвентаря/интерфейса.")]
    public Sprite icon;

    [Header("Бой")]
    [Min(0f)]
    [Tooltip("Базовый урон за одну атаку.")]
    public float damage = 10f;

    [Min(0.1f)]
    [Tooltip("Скорость атаки (атак в секунду). 1 = 1 удар в секунду.")]
    public float attackSpeed = 1f;

    [Min(0f)]
    [Tooltip("Дальность действия оружия (радиус удара или дальность выстрела).")]
    public float range = 2f;

    [Min(0f)]
    [Tooltip("Сила отталкивания цели при попадании (опционально).")]
    public float knockbackForce = 0f;

    [Header("Анимация и эффекты (по желанию)")]
    [Tooltip("Имя анимации атаки в Animator (опционально).")]
    public string attackAnimationName;

    [Tooltip("Звук атаки (удар/выстрел).")]
    public AudioClip attackSound;

    [Header("Снаряды (для дальнего боя)")]
    [Tooltip("Префаб снаряда (для лука/магии). Может быть пустым для ближнего боя.")]
    public GameObject projectilePrefab;
}
```

Разбор ключевых моментов:

- `WeaponType` помогает отличать ближнее, дальнее и магическое оружие в других системах.
- `attackSpeed` задаётся в **атаках в секунду**:
  - 1.0 → 1 атака в секунду;
  - 2.0 → 2 атаки в секунду (0.5 секунды между ударами);
  - позже мы превратим это значение в задержку в `WeaponBase`.
- Поле `projectilePrefab` нужно только для дальнего оружия, но удобно хранить его прямо в `WeaponData`, чтобы разные луки могли стрелять разными стрелами.

---

## 4. Создание ассетов WeaponData

Теперь создадим конкретные экземпляры данных оружия.

1. Перейди в папку `Assets/ScriptableObjects/Weapons/`.
2. ПКМ → `Create` → `Game Data` → `Weapon Data`.
3. Создай минимум 3 ассета:
   - `Weapon_Sword_Default`
   - `Weapon_Bow_Default`
   - `Weapon_Staff_Default`

4. Для каждого ассета в Inspector укажи примерные значения:

- **Weapon_Sword_Default**:
  - `Weapon Name` — «Простой меч»
  - `Weapon Type` — `Melee`
  - `Damage` — `20`
  - `Attack Speed` — `1.2`
  - `Range` — `2`
  - `Knockback Force` — `0` (можно добавить позже)

- **Weapon_Bow_Default**:
  - `Weapon Name` — «Охотничий лук»
  - `Weapon Type` — `Ranged`
  - `Damage` — `15`
  - `Attack Speed` — `1.0`
  - `Range` — `12`

- **Weapon_Staff_Default**:
  - `Weapon Name` — «Ученический посох»
  - `Weapon Type` — `Magic`
  - `Damage` — `10`
  - `Attack Speed` — `0.8`
  - `Range` — `10`

Иконки, звуки, префабы снарядов можно не заполнять сразу — к ним можно вернуться позже.

---

## 5. Как WeaponData будет использоваться дальше

На следующих уроках Этапа 6:

- `WeaponBase` будет хранить ссылку на `WeaponData` и:
  - использовать `damage` при расчёте урона;
  - использовать `attackSpeed` для расчёта задержки между атаками;
  - использовать `range` для радиуса удара или дальности полёта снарядов.
- `MeleeWeapon` будет:
  - брать радиус удара из `hitRadius` или `range`;
  - находить цели в пределах этой дистанции.
- `RangedWeapon` будет:
  - создавать снаряд `projectilePrefab`;
  - назначать ему урон и максимальную дистанцию `range`.
- `WeaponManager` на игроке будет знать, какое именно `WeaponData` сейчас используется, и сможет показывать его характеристики в UI (урон, тип, скорость атаки и т.д.).

Так же, как и с `PlayerData`, ты сможешь:

- создавать разные варианты одного оружия (например, `Weapon_Sword_Iron`, `Weapon_Sword_Steel`) без изменения кода;
- настраивать баланс через Inspector, а не через переписывание скриптов.

---

## 6. Мини‑проверка

Ответь на вопросы (устно или письменно):

1. Чем `WeaponData` похож на `PlayerData`?
2. Какие параметры оружия удобно хранить в ScriptableObject, а какие — в компонентах?
3. Почему выгодно хранить префаб снаряда (`projectilePrefab`) прямо в `WeaponData`?

И проверь в проекте:

- Класс `WeaponData` наследуется от `ScriptableObject`, а не от `MonoBehaviour`.
- В папке `Assets/ScriptableObjects/Weapons/` есть ассеты для разных видов оружия.
- Изменяя `damage` в `Weapon_Sword_Default`, ты понимаешь, что это изменит урон меча во всех системах, которые используют этот `WeaponData`.

Если всё это верно — переходи к уроку 6.2 (`WeaponBase` — базовый класс оружия и наследование).

